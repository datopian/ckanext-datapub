(this["webpackJsonpdatapub-nhs"]=this["webpackJsonpdatapub-nhs"]||[]).push([[0],{236:function(e,t){},304:function(e,t,a){e.exports=a(691)},339:function(e,t){},341:function(e,t){},350:function(e,t){},352:function(e,t){},378:function(e,t){},379:function(e,t){},384:function(e,t){},386:function(e,t){},410:function(e,t){},507:function(e,t){},510:function(e,t){},511:function(e,t){},519:function(e,t){},521:function(e,t){},619:function(e,t,a){var n={"./geojson.json":279,"./table-schema.json":620,"./topojson.json":280};function r(e){var t=s(e);return a(t)}function s(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=s,e.exports=r,r.id=619},688:function(e,t,a){},689:function(e,t,a){},690:function(e,t,a){},691:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(301),c=a.n(s),o=a(20),i=a(2),l=a.n(i),u=a(19),d=a(91),m=a(92),p=a(54),h=a(96),f=a(95),v=a(302),g=a(152),b=a.n(g),E=a(303),S=a(41),k=a(93),x=a(94),N=(a(688),function(e){var t=Object(n.useState)(0),a=Object(x.a)(t,2),s=a[0],c=a[1],o=Object(n.useRef)(null),i=e.size,l=e.progress,u=e.strokeWidth,d=e.circleOneStroke,m=e.circleTwoStroke,p=e.timeRemaining,h=i/2,f=i/2-u/2,v=2*Math.PI*f;return Object(n.useEffect)((function(){c((100-l)/100*v),o.current.style="transition: stroke-dashoffset 850ms ease-in-out"}),[c,l,v,s]),r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{className:"svg",width:i,height:i},r.a.createElement("circle",{className:"svg-circle-bg",stroke:d,cx:h,cy:h,r:f,strokeWidth:u}),r.a.createElement("circle",{className:"svg-circle",ref:o,stroke:m,cx:h,cy:h,r:f,strokeWidth:u,strokeDasharray:v,strokeDashoffset:s}),r.a.createElement("text",{x:"".concat(h),y:"".concat(h+2),className:"svg-circle-text"},l,"%")),p>0&&r.a.createElement("span",{className:"time-remaining"},p>60?"".concat(Math.floor(p/60)," minute").concat(Math.floor(p/60)>1?"s":""):"".concat(Math.floor(p)," second").concat(p>1?"s":"")," left"))}),w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===e)return"0 Bytes";var a=1e3,n=t<0?0:t,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,s)).toFixed(n))+" "+r[s]},j=function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).onChangeHandler=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,s,c,o,i,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state,r=a.formattedSize,s=a.selectedFile,c=["csv","tsv","xls","xlsx","zip","pdf","json","geojson"],!(t.target.files.length>0)){e.next=23;break}if(s=t.target.files[0],o=k.open(s),!["csv","tsv","xls","xlsx"].includes(o.descriptor.format)){e.next=14;break}return e.prev=6,e.next=9,o.addSchema();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.warn(e.t0);case 14:if(c.includes(o.descriptor.format)){e.next=17;break}return n.setState({selectedFile:s,loaded:0,success:!1,fileExists:!1,error:"File format not supported"}),e.abrupt("return");case 17:return r=w(o.size),i=Object(p.a)(n),e.next=21,o.hash("sha256",(function(e){i.onHashProgress(e)}));case 21:u=e.sent,n.props.metadataHandler(Object.assign(o.descriptor,{hash:u}));case 23:return n.setState({selectedFile:s,loaded:0,success:!1,fileExists:!1,error:!1,formattedSize:r}),e.next=26,n.onClickHandler();case 26:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(t){return e.apply(this,arguments)}}(),n.onHashProgress=function(e){100===e?n.setState({hashInProgress:!1}):n.setState({hashLoaded:e,hashInProgress:!0})},n.onUploadProgress=function(e){n.onTimeRemaining(e.loaded),n.setState({loaded:e.loaded/e.total*100})},n.onTimeRemaining=function(e){var t=e/(((new Date).getTime()-n.state.start)/1e3)/1024,a=(n.state.fileSize-e)/t;n.setState({timeRemaining:a/1e3})},n.onClickHandler=Object(u.a)(l.a.mark((function e(){var t,a,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(new Date).getTime(),a=n.state.selectedFile,r=n.props.client,s=k.open(a),n.setState({fileSize:s.size,start:t,loading:!0}),n.props.handleUploadStatus({loading:!0,error:!1,success:!1}),r.pushBlob(s,n.onUploadProgress).then((function(e){n.setState({success:!0,loading:!1,fileExists:!e,loaded:100}),n.props.handleUploadStatus({loading:!1,success:!0})})).catch((function(e){console.error("Upload failed with error: "+e),n.setState({error:!0,loading:!1}),n.props.handleUploadStatus({loading:!1,success:!1,error:!0})}));case 7:case"end":return e.stop()}}),e)}))),n.state={datasetId:e.datasetId,selectedFile:null,fileSize:0,formattedSize:"0 KB",start:"",loaded:0,success:!1,error:!1,fileExists:!1,loading:!1,timeRemaining:0,hashInProgress:!1,hashLoaded:0},n}return Object(m.a)(a,[{key:"render",value:function(){var e=this.state,t=e.success,a=e.fileExists,n=e.error,s=e.timeRemaining,c=e.selectedFile,o=e.formattedSize,i=e.hashInProgress;return r.a.createElement("div",{className:"upload-area"},r.a.createElement(S.Choose,{onChangeHandler:this.onChangeHandler,onChangeUrl:function(e){return console.log("Get url:",e.target.value)}}),r.a.createElement("div",{className:"upload-area__info"},i&&r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"upload-list"},r.a.createElement("li",{className:"list-item"},r.a.createElement("div",{className:"upload-list-item"},r.a.createElement("div",null,r.a.createElement("p",{className:"upload-file-name"},"Computing file hash...")),r.a.createElement("div",null,r.a.createElement(N,{progress:Math.round(this.state.hashLoaded),size:100,strokeWidth:5,circleOneStroke:"#d9edfe",circleTwoStroke:"#7ea9e1"}))))))),r.a.createElement("div",{className:"upload-area__info"},c&&r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"upload-list"},r.a.createElement("li",{className:"list-item"},r.a.createElement("div",{className:"upload-list-item"},r.a.createElement("div",null,r.a.createElement("p",{className:"upload-file-name"},"Uploading ",c.name),r.a.createElement("p",{className:"upload-file-size"},o)),r.a.createElement("div",null,r.a.createElement(N,{progress:Math.round(this.state.loaded),size:100,strokeWidth:5,circleOneStroke:"#d9edfe",circleTwoStroke:"#7ea9e1",timeRemaining:s}))))),r.a.createElement("h2",{className:"upload-message"},t&&!a&&!n&&"File uploaded successfully",a&&"File uploaded successfully",n&&"Upload failed ".concat("string"===typeof n?n:"")))))}}]),a}(r.a.Component),O=function(e){var t=e.resources,a=(e.client,e.onSchemaSelected),s=Object(n.useState)(""),c=Object(x.a)(s,2),o=c[0],i=c[1],d=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.target.value,i(t.target.value),a(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"app-form-field"},r.a.createElement("label",{className:"metadata-label"},"Copy metadata information from existing resource"),r.a.createElement("select",{className:"app-form-field-input",value:o,onChange:d},r.a.createElement("option",{value:""},"Select..."),t.map((function(e,t){var a=e.name,n=e.schema,s=e.id;return r.a.createElement("option",{key:"select-schema-option-".concat(s,"-").concat(t),value:s,disabled:!n},a," ",n?"":"(no schema to copy)")}))))},_=(a(689),[{label:"Access Restriction",name:"restricted",input_type:"select",values:['{"level": "public"}','{"level": "private"}'],options:["Public","Private"]}]),y=function(e){var t=e.metadata,a=e.handleChange;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{className:"metadata-name"},t.path),r.a.createElement("div",{className:"metadata-form"},r.a.createElement("div",{className:"metadata-input"},r.a.createElement("label",{className:"metadata-label",htmlFor:"title"},"Title"),r.a.createElement("input",{className:"metadata-input__input",type:"text",name:"title",id:"title",value:t.title||t.name,onChange:a})),r.a.createElement("div",{className:"metadata-input"},r.a.createElement("label",{className:"metadata-label",htmlFor:"description"},"Description"),r.a.createElement("input",{className:"metadata-input__input",type:"text",name:"description",id:"description",value:t.description||"",onChange:a})),r.a.createElement("div",{className:"metadata-input"},r.a.createElement("label",{className:"metadata-label",htmlFor:"encoding"},"Encoding"),r.a.createElement("select",{className:"metadata-input__input",name:"encoding",id:"encoding",value:t.encoding||"",onChange:a,required:!0},r.a.createElement("option",{value:"",disabled:!0},"Select..."),S.encodeData.map((function(e){return r.a.createElement("option",{key:"format-".concat(e.value),value:e.value},e.label)})))),r.a.createElement("div",{className:"metadata-input"},r.a.createElement("label",{className:"metadata-label",htmlFor:"format"},"Format"),r.a.createElement("select",{className:"metadata-input__input",name:"format",id:"format",value:(t.format||"").toLowerCase(),onChange:a,required:!0},r.a.createElement("option",{value:"",disabled:!0},"Select..."),S.formatData.map((function(e){return r.a.createElement("option",{key:"format-".concat(e[0]),value:e[0].toLowerCase()},e[0])})))),_&&_.map((function(e){return r.a.createElement("div",{key:"metadata-custom-".concat(e.name),className:"metadata-input"},r.a.createElement("label",{className:"metadata-label",htmlFor:"format"},e.label),r.a.createElement("select",{className:"metadata-input__input",name:e.name,id:e.name,value:t[e.name]||"",onChange:a,required:!0},r.a.createElement("option",{value:"",disabled:!0},"Select..."),e.options.map((function(t,a){return r.a.createElement("option",{key:"".concat(e.name,"-").concat(a),value:e.values[a]},t)}))))}))))},C=(a(690),function(e){Object(h.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).handleChangeMetadata=function(e){var t=e.target,a=t.value,r=t.name,s=n.state.resource;s[r]=a,n.setState({resource:s})},n.handleSubmitMetadata=Object(u.a)(l.a.mark((function e(){var t,a,r,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state,a=t.resource,r=t.client,e.next=3,n.createResource(a);case 3:return!0,e.next=7,r.action("package_show",{id:n.state.datasetId});case 7:if(s=e.sent,"draft"!==(c=s.result).state){e.next=13;break}return c.state="active",e.next=13,r.action("package_update",c);case 13:return e.abrupt("return",window.location.href="/dataset/".concat(n.state.datasetId));case 14:case"end":return e.stop()}}),e)}))),n.createResource=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,s,c,i,u,d,m,p,h,f,v;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.state.client,r=n.props.config,s=r.organizationId,c=r.datasetId,i=r.resourceId,u=t.urlName,delete t.urlName,d=b.a.resourceFrictionlessToCkan(t),m=Object(o.a)({},d.sample),delete d.sample,p=d.bq_table_name?d.bq_table_name:Object(E.v4)(),h=Object(o.a)(Object(o.a)({},d),{},{package_id:n.state.datasetId,name:t.name||t.title,sha256:t.hash,size:t.size,lfs_prefix:"".concat(s,"/").concat(c),url:u,url_type:"upload",bq_table_name:(l=p,l.replace(/-/g,"")),sample:m}),!i){e.next=16;break}return h=Object(o.a)(Object(o.a)({},h),{},{id:i}),u||(h.url="".concat(null===t||void 0===t||null===(f=t.name)||void 0===f?void 0:f.toLowerCase(),".").concat(null===t||void 0===t||null===(v=t.format)||void 0===v?void 0:v.toLowerCase())),e.next=15,a.action("resource_update",h);case 15:return e.abrupt("return",window.location.href="/dataset/".concat(c));case 16:return e.next=18,a.action("resource_create",h).then((function(e){n.onChangeResourceId(e.result.id)}));case 18:case"end":return e.stop()}var l}),e)})));return function(t){return e.apply(this,arguments)}}(),n.deleteResource=Object(u.a)(l.a.mark((function e(){var t,a,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state,a=t.resource,r=t.client,s=t.datasetId,!window.confirm("Are you sure to delete this resource?")){e.next=5;break}return e.next=4,r.action("resource_delete",{id:a.id});case 4:return e.abrupt("return",window.location.href="/dataset/".concat(s));case 5:case"end":return e.stop()}}),e)}))),n.setLoading=function(e){n.setState({ui:Object(o.a)(Object(o.a)({},n.state.ui),{},{loading:e})})},n.handleUploadStatus=function(e){var t=n.state.ui,a=Object(o.a)(Object(o.a)({},t),{},{success:e.success,error:e.error,loading:e.loading});n.setState({ui:a})},n.onChangeResourceId=function(e){n.setState({resourceId:e})},n.onSchemaSelected=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setLoading(!0),e.next=3,n.getSchemaWithSample(t);case 3:a=e.sent,r=a.sample,s=a.schema,n.setLoading(!1),n.setState({resource:Object.assign(n.state.resource,{schema:s,sample:r})});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.getSchemaWithSample=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,s,c,o,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.client,e.next=3,a.action("resource_schema_show",{id:t});case 3:return r=e.sent,e.next=6,a.action("resource_sample_show",{id:t});case 6:s=e.sent,c=[],o=r.result||{fields:[]};try{for(i in s.result)c.push(s.result[i])}catch(l){console.error(l)}return e.abrupt("return",{schema:o,sample:c});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.setResource=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.client,e.next=3,a.action("resource_show",{id:t});case 3:return r=e.sent,s=r.result,e.t0=o.a,e.t1=Object(o.a)({},s),e.next=9,n.getSchemaWithSample(t);case 9:return e.t2=e.sent,c=(0,e.t0)(e.t1,e.t2),e.abrupt("return",n.setState({client:a,resourceId:t,resource:c,isResourceEdit:!0}));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={resources:[],datasetId:n.props.config.datasetId,resourceId:"",resource:n.props.resource||{},ui:{fileOrLink:"",uploadComplete:void 0,success:!1,error:!1,loading:!1},client:null,isResourceEdit:!1},n.metadataHandler=n.metadataHandler.bind(Object(p.a)(n)),n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,r,s,c,o,i,u,d,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.config,a=t.authToken,n=t.api,r=t.lfs,s=t.organizationId,c=t.datasetId,o=t.resourceId,i=new v.Client("".concat(a),"".concat(s),"".concat(c),"".concat(n),"".concat(r)),e.next=5,i.action("package_show",{id:c});case 5:u=e.sent,d=u.result,m=d.resources||[],this.setState({client:i,resources:m}),o&&this.setResource(o);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"metadataHandler",value:function(e){var t=this.extendResource(e);this.setState({resource:t})}},{key:"extendResource",value:function(e){var t=Object(o.a)({},e);t.title=e.name,t.urlName=e.name,t.size=e.size;var a=e.name.split(".")[0].toUpperCase();return t.name=a,t.bq_table_name=a,t}},{key:"render",value:function(){var e=this,t=this.state.ui,a=t.success,n=t.loading;return r.a.createElement("div",{className:"App"},r.a.createElement("form",{className:"upload-wrapper",onSubmit:function(t){return t.preventDefault(),e.state.isResourceEdit?e.createResource(e.state.resource):e.handleSubmitMetadata()}},r.a.createElement("div",{className:"upload-header"},r.a.createElement("h2",{className:"upload-header__title"},"Resource Editor")),r.a.createElement(j,{client:this.state.client,resource:this.state.resource,metadataHandler:this.metadataHandler,datasetId:this.state.datasetId,handleUploadStatus:this.handleUploadStatus,onChangeResourceId:this.onChangeResourceId}),r.a.createElement("div",{className:"upload-edit-area"},r.a.createElement(y,{metadata:this.state.resource,handleChange:this.handleChangeMetadata}),r.a.createElement("div",{className:"app-form-grid app-divider"},r.a.createElement(O,{resources:this.state.resources,onSchemaSelected:this.onSchemaSelected})),this.state.resource.schema&&r.a.createElement(S.TableSchema,{schema:this.state.resource.schema,data:this.state.resource.sample||[]}),this.state.isResourceEdit?r.a.createElement("div",{className:"resource-edit-actions"},r.a.createElement("button",{type:"button",className:"btn btn-delete",onClick:this.deleteResource},"Delete"),r.a.createElement("button",{className:"btn"},"Update")):r.a.createElement("button",{disabled:!a||n,className:"btn"},"Save and Publish"))))}}]),a}(r.a.Component));C.defaultProps={config:{authToken:"be270cae-1c77-4853-b8c1-30b6cf5e9878",api:"http://localhost:5000",lfs:"http://localhost:5001",organizationId:"myorg",datasetId:"data-test-2"}};var I=C,R=document.getElementById("ResourceEditor");if(R){var z={datasetId:R.getAttribute("data-dataset-id"),api:R.getAttribute("data-api"),lfs:R.getAttribute("data-lfs"),authToken:R.getAttribute("data-auth-token"),organizationId:R.getAttribute("data-organization-id"),resourceId:R.getAttribute("data-resource-id")};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(I,{config:z,resource:R.getAttribute("data-resource")})),R)}}},[[304,1,2]]]);
//# sourceMappingURL=main.1cac725b.chunk.js.map